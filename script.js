// –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
const screenshotsData = {
  basic: [
    {
      image: "src/1.jpg",
      title: "–í—ã–±–æ—Ä —É—Å–ª—É–≥–∏",
      description: "–ù–∞ —ç—Ç–æ–º —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–æ, –∫–∞–∫ –≤—ã–±—Ä–∞—Ç—å —É—Å–ª—É–≥—É –Ω–∞ —Å–∞–π—Ç–µ.",
    },
    {
      image: "src/2.jpg",
      title: "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —É—Å–ª—É–≥–∏",
      description:
        "–ó–¥–µ—Å—å –ø–æ–∫–∞–∑–∞–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å–ª—É–≥–µ. –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã: –ø–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å –∫–Ω–æ–ø–∫–∞–º–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –æ–±–ª–∞—Å—Ç—å –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ –∏ –ª–∏–Ω–µ–π–∫–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ—Ç—Å—Ç—É–ø–æ–≤. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–µ—á–∞—Ç–∏ –≤ –≤–µ—Ä—Ö–Ω–µ–º –ª–µ–≤–æ–º —É–≥–ª—É.",
    },
    {
      image: "src/3.jpg",
      title: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞",
      description:
        "–≠—Ç–æ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –í–∞–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã: –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å Wi-Fi, —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ç–µ–π –∏ –∫–Ω–æ–ø–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∑–Ω–∞—á–æ–∫ —É—Ä–æ–≤–Ω—è —Å–∏–≥–Ω–∞–ª–∞ —Ä—è–¥–æ–º —Å –∫–∞–∂–¥–æ–π —Å–µ—Ç—å—é - –æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.",
    },
    {
      image: "src/4.jpg",
      title: "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ",
      description:
        "–°–∫—Ä–∏–Ω—à–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–∞–π—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∑–Ω–∞—á–æ–∫ –∑–∞–º–∫–∞ —Ä—è–¥–æ–º —Å –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π - –æ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ. –¢–∞–∫–∂–µ –≤–∞–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–∞–π—Ç.",
    },
    {
      image: "src/5.jpg",
      title: "–†–∞–±–æ—Ç–∞ —Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç–æ–π",
      description:
        "–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—á—Ç–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞. –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã: —Å–ø–∏—Å–æ–∫ –ø–∏—Å–µ–º, –æ–±–ª–∞—Å—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–∏—Å—å–º–∞ –∏ –ø–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–∏—Å–µ–º. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –æ—Ç–≤–µ—Ç–∞, –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –∏ —É–¥–∞–ª–µ–Ω–∏—è –ø–∏—Å–µ–º.",
    },
    {
      image: "src/6.jpg",
      title: "–†–∞–±–æ—Ç–∞ —Å —ç–ª–µ–∫—Ç–æ–Ω–Ω–π –ø–æ—Ç–æ–π",
      description:
        "–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—á—Ç–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞. –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã: —Å–ø–∏—Å–æ–∫ –ø–∏—Å–µ–º, –æ–±–ª–∞—Å—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–∏—Å—å–º–∞ –∏ –ø–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–∏—Å–µ–º. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –æ—Ç–≤–µ—Ç–∞, –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –∏ —É–¥–∞–ª–µ–Ω–∏—è –ø–∏—Å–µ–º.",
    },
    {
      image: "src/7.jpg",
      title: "–†–∞–±—Ç–∞ —Å —ç–µ—Ç–æ–æ –ø—á—Ç–π",
      description:
        "–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—á—Ç–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞. –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã: —Å–ø–∏—Å–æ–∫ –ø–∏—Å–µ–º, –æ–±–ª–∞—Å—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–∏—Å—å–º–∞ –∏ –ø–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–∏—Å–µ–º. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –æ—Ç–≤–µ—Ç–∞, –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –∏ —É–¥–∞–ª–µ–Ω–∏—è –ø–∏—Å–µ–º.",
    },
  ],
  advanced: [
    {
      image: "src/8.jpg",
      title: "–ö–æ–≥–¥–∞ –∂–µ —Å–æ–±–∞–∫–∞ —Å—É—Ç—É–ª–∞—è —Å–∫–∏–Ω–µ—Ç –º–Ω–µ —Ç–æ, —á—Ç–æ –Ω–∞–¥–æ?",
      description:
        "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—á. –°–∫—Ä–∏–Ω—à–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ–º–∞–Ω–¥ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–æ–≤.",
    },
  ],
};

// –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
let currentStep = 0;
let currentDifficulty = "basic";
let isVoiceEnabled = false;
let speech = null;
let cursorHintTimeout = null;

// –≠–ª–µ–º–µ–Ω—Ç—ã DOM
const screenshotImg = document.getElementById("screenshot-img");
const screenshotTitle = document.getElementById("screenshot-title");
const screenshotText = document.getElementById("screenshot-text");
const prevBtn = document.getElementById("prev-btn");
const nextBtn = document.getElementById("next-btn");
const basicBtn = document.getElementById("basic-btn");
const advancedBtn = document.getElementById("advanced-btn");
const voiceBtn = document.getElementById("voice-btn");
const voiceStatus = document.getElementById("voice-status");
const helpBtn = document.getElementById("help-btn");
const helpOverlay = document.getElementById("help-overlay");
const closeHelp = document.getElementById("close-help");
const progressFill = document.getElementById("progress-fill");
const currentStepElement = document.getElementById("current-step");
const difficultyIndicator = document.getElementById("difficulty-indicator");
const cursorHint = document.getElementById("cursor-hint");

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–∏–Ω—Ç–µ–∑–∞
function initializeSpeech() {
  if ("speechSynthesis" in window) {
    speech = new SpeechSynthesisUtterance();
    speech.lang = "ru-RU";
    speech.rate = 0.9;
    speech.pitch = 1;

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–æ–ª–æ—Å –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
    const voices = speechSynthesis.getVoices();
    const russianVoice = voices.find((voice) => voice.lang.startsWith("ru"));
    if (russianVoice) {
      speech.voice = russianVoice;
    }
  } else {
    voiceBtn.disabled = true;
    voiceStatus.textContent =
      "–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ";
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–∫—Ä–∏–Ω—à–æ—Ç–∞
function loadScreenshot(step) {
  const screenshots = screenshotsData[currentDifficulty];

  if (step >= 0 && step < screenshots.length) {
    const screenshot = screenshots[step];

    screenshotImg.src = screenshot.image;
    screenshotTitle.textContent = screenshot.title;
    screenshotText.textContent = screenshot.description;

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫
    prevBtn.disabled = step === 0;
    nextBtn.disabled = step === screenshots.length - 1;

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    const progress = ((step + 1) / screenshots.length) * 100;
    progressFill.style.width = `${progress}%`;

    currentStepElement.textContent = `–®–∞–≥ ${step + 1} –∏–∑ ${screenshots.length}`;
    difficultyIndicator.textContent = `–£—Ä–æ–≤–µ–Ω—å: ${currentDifficulty === "basic" ? "–ë–∞–∑–æ–≤—ã–π" : "–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π"}`;

    // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–æ–ª–æ—Å, –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω
    if (isVoiceEnabled) {
      speechSynthesis.cancel();
      setTimeout(() => speakCurrentDescription(), 300);
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫—É—Ä—Å–æ—Ä —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
    clearTimeout(cursorHintTimeout);
    cursorHintTimeout = setTimeout(showCursorHint, 1000);

    // –ü–æ–¥—Å–≤–µ—Ç–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–æ–Ω—ã
    highlightActiveAreas();
  }
}

// –ü–æ–∫–∞–∑–∞—Ç—å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫—É—Ä—Å–æ—Ä
function showCursorHint() {
  const container = document.querySelector(".screenshot-container");
  const rect = container.getBoundingClientRect();

  // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –∫—É—Ä—Å–æ—Ä –≤ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–π —Ç–æ—á–∫–µ
  const x = rect.left + rect.width * 0.7;
  const y = rect.top + rect.height * 0.3;

  cursorHint.style.left = `${x}px`;
  cursorHint.style.top = `${y}px`;
  cursorHint.style.opacity = "1";

  // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫—É—Ä—Å–æ—Ä —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è
  setTimeout(() => {
    const newX = rect.left + rect.width * 0.3;
    const newY = rect.top + rect.height * 0.6;

    cursorHint.style.left = `${newX}px`;
    cursorHint.style.top = `${newY}px`;
  }, 1000);

  // –°–∫—Ä—ã—Ç—å –∫—É—Ä—Å–æ—Ä —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
  setTimeout(() => {
    cursorHint.style.opacity = "0";
  }, 3000);
}

// –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–æ–Ω
function highlightActiveAreas() {
  // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
  const previousHighlights = document.querySelectorAll(".highlight");
  previousHighlights.forEach((el) => el.classList.remove("highlight"));

  // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –∫ –∫–Ω–æ–ø–∫–∞–º –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
  setTimeout(() => {
    if (currentStep < screenshotsData[currentDifficulty].length - 1) {
      nextBtn.classList.add("highlight");
    }

    if (currentStep > 0) {
      prevBtn.classList.add("highlight");
    }

    // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
      nextBtn.classList.remove("highlight");
      prevBtn.classList.remove("highlight");
    }, 2000);
  }, 500);
}

// –û–∑–≤—É—á–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è
function speakCurrentDescription() {
  if (!isVoiceEnabled || !speech) return;

  const screenshots = screenshotsData[currentDifficulty];
  const screenshot = screenshots[currentStep];

  speech.text = `${screenshot.title}. ${screenshot.description}`;
  speechSynthesis.speak(speech);
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è
function toggleVoice() {
  isVoiceEnabled = !isVoiceEnabled;

  if (isVoiceEnabled) {
    voiceBtn.classList.add("active");
    voiceBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
    voiceStatus.textContent = "–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ";
    speakCurrentDescription();
  } else {
    voiceBtn.classList.remove("active");
    voiceBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
    voiceStatus.textContent = "–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –≤—ã–∫–ª—é—á–µ–Ω–æ";
    speechSynthesis.cancel();
  }
}

// –°–º–µ–Ω–∞ —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
function changeDifficulty(difficulty) {
  currentDifficulty = difficulty;
  currentStep = 0;

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
  basicBtn.classList.toggle("active", difficulty === "basic");
  advancedBtn.classList.toggle("active", difficulty === "advanced");

  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–≤–æ–≥–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
  loadScreenshot(currentStep);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
function init() {
  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–≤–æ–≥–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞
  loadScreenshot(currentStep);

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–∏–Ω—Ç–µ–∑–∞
  initializeSpeech();

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
  prevBtn.addEventListener("click", () => {
    if (currentStep > 0) {
      currentStep--;
      loadScreenshot(currentStep);
    }
  });

  nextBtn.addEventListener("click", () => {
    const screenshots = screenshotsData[currentDifficulty];
    if (currentStep < screenshots.length - 1) {
      currentStep++;
      loadScreenshot(currentStep);
    }
  });

  basicBtn.addEventListener("click", () => changeDifficulty("basic"));
  advancedBtn.addEventListener("click", () => changeDifficulty("advanced"));

  voiceBtn.addEventListener("click", toggleVoice);

  helpBtn.addEventListener("click", () => {
    helpOverlay.classList.add("active");
  });

  closeHelp.addEventListener("click", () => {
    helpOverlay.classList.remove("active");
  });

  helpOverlay.addEventListener("click", (e) => {
    if (e.target === helpOverlay) {
      helpOverlay.classList.remove("active");
    }
  });

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  window.speechSynthesis.onvoiceschanged = initializeSpeech;

  // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –ø–æ–º–æ—â–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ—Å–µ—â–µ–Ω–∏–∏
  setTimeout(() => {
    helpBtn.classList.add("highlight");
    setTimeout(() => helpBtn.classList.remove("highlight"), 3000);
  }, 2000);
}

// –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener("DOMContentLoaded", init);

let progressStore = JSON.parse(localStorage.getItem("progress")) || {};

// –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
function restoreProgress() {
  if (progressStore[currentDifficulty] !== undefined) {
    currentStep = progressStore[currentDifficulty];
    loadScreenshot(currentStep);
  }
}

// —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
function saveProgress() {
  progressStore[currentDifficulty] = currentStep;
  localStorage.setItem("progress", JSON.stringify(progressStore));
}

// –ø–µ—Ä–µ—Ö–≤–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–≥–∞
const oldLoadScreenshot = loadScreenshot;
loadScreenshot = function (step) {
  oldLoadScreenshot(step);
  saveProgress();

  // –í–°–ï–ì–î–ê –ø—Ä—è—á–µ–º –ø—Ä–∞–∫—Ç–∏–∫—É –∏ —Ç–µ—Å—Ç –ø—Ä–∏ —Å–º–µ–Ω–µ —à–∞–≥–∞
  const taskBox = document.getElementById("task-box");
  const testBox = document.getElementById("test-box");
  if (taskBox) taskBox.classList.add("hidden");
  if (testBox) testBox.classList.add("hidden");

  // –ø—Ä–∞–∫—Ç–∏–∫–∞ –ø–æ—Å–ª–µ 3 —à–∞–≥–∞
  if (currentDifficulty === "basic" && step === 2) {
    showTask("–ß—Ç–æ –Ω—É–∂–Ω–æ –Ω–∞–∂–∞—Ç—å, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —É—Å–ª—É–≥—É?");
  }

  // —Ç–µ—Å—Ç –≤ –∫–æ–Ω—Ü–µ
  if (step === screenshotsData[currentDifficulty].length - 1) {
    showTest();
  }
};

// ===== –ø—Ä–∞–∫—Ç–∏–∫–∞ =====
function showTask(text) {
  const box = document.getElementById("task-box");
  if (!box) return;
  document.getElementById("task-text").textContent = text;
  box.classList.remove("hidden");
}

function checkTask() {
  alert("–í–µ—Ä–Ω–æ!");
  document.getElementById("task-box").classList.add("hidden");
}

// ===== —Ç–µ—Å—Ç =====
function showTest() {
  const box = document.getElementById("test-box");
  if (!box) return;
  box.classList.remove("hidden");
}

function finishTest() {
  alert("üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: –∫—É—Ä—Å –ø—Ä–æ–π–¥–µ–Ω!");
  document.getElementById("test-box").classList.add("hidden");
}

// –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
const oldInit = init;
init = function () {
  oldInit();
  restoreProgress();
};
